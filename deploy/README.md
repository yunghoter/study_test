# Локальне розгортання за допомогою Docker Compose

Цей документ описує, як розгорнути додаток локально за допомогою Docker Compose.

## Передумови

1.  **Docker**: Переконайтеся, що у вас встановлено Docker. Інструкції зі встановлення можна знайти на [офіційному сайті Docker](https://docs.docker.com/get-docker/).
2.  **Docker Compose**: Docker Compose зазвичай встановлюється разом з Docker Desktop. Якщо ні, інструкції можна знайти [тут](https://docs.docker.com/compose/install/).
3.  **Образ додатку**: Переконайтеся, що образ вашого додатку (`college-schedule-app`) доступний локально або в зазначеному репозиторії контейнерів (наприклад, GHCR). Якщо ви збираєте образ локально, виконайте відповідні кроки для його збірки.

## Кроки для розгортання

1.  **Перейдіть до папки `deploy`**:
    Відкрийте термінал або командний рядок і перейдіть до папки, де знаходиться файл `docker-compose.yml` (ця папка `deploy`).
    ```bash
    cd шлях/до/вашого/проекту/deploy
    ```

2.  **Налаштування змінних середовища (за потреби)**:
    Файл `docker-compose.yml` може використовувати змінні середовища для конфігурації образу додатку. Основними змінними є `GITHUB_REPOSITORY` та `VERSION`.

    *   **`GITHUB_REPOSITORY`**: Це ваш репозиторій на GitHub у форматі `ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ` (наприклад, `chdbc-samples/college-schedule-app`).
    *   **`VERSION`**: Версія образу додатку, яку потрібно розгорнути (наприклад, `0.3.0-SNAPSHOT` або `latest`).

    Ви можете встановити ці змінні у вашому терміналі перед запуском Docker Compose:

    **Для Linux/macOS:**
    ```bash
    export GITHUB_REPOSITORY="ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ"
    export VERSION="версія_образу"
    ```
    Замініть `ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ` та `версія_образу` на ваші актуальні значення.

    **Для Windows (Command Prompt):**
    ```cmd
    set GITHUB_REPOSITORY=ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ
    set VERSION=версія_образу
    ```

    **Для Windows (PowerShell):**
    ```powershell
    $env:GITHUB_REPOSITORY="ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ"
    $env:VERSION="версія_образу"
    ```

    **Альтернатива:** Ви можете створити файл `.env` у папці `deploy` і визначити змінні там:
    ```env
    # filepath: c:\GitHub\college-schedule-app\deploy\.env
    GITHUB_REPOSITORY=ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ
    VERSION=версія_образу
    ```
    Docker Compose автоматично підхопить значення з цього файлу.

3.  **Запустіть Docker Compose**:
    Виконайте команду для запуску сервісів у фоновому режимі (`-d`):
    ```bash
    docker-compose up -d
    ```
    Якщо ви хочете бачити логи в терміналі, запустіть без прапорця `-d`:
    ```bash
    docker-compose up
    ```
    Ця команда завантажить необхідні образи (якщо їх немає локально) та запустить контейнери для додатку (`app`) та бази даних (`db`).

4.  **Перевірка стану контейнерів**:
    Щоб перевірити, чи контейнери успішно запустилися, виконайте:
    ```bash
    docker-compose ps
    ```
    Ви повинні побачити контейнери `app` та `db` зі статусом `Up` або `running`.

5.  **Доступ до додатку**:
    Після успішного запуску, ваш додаток повинен бути доступний за адресою, вказаною у конфігурації сервісу `app` (зазвичай `http://localhost:ПОРТ_ДОДАТКУ`). Перевірте файл `docker-compose.yml` на наявність мапінгу портів для сервісу `app`. Наприклад, якщо там вказано `ports: - "8080:8080"`, то додаток буде доступний за адресою `http://localhost:8080`.

    База даних PostgreSQL буде доступна на `localhost:5432` (якщо стандартний порт не змінено).

6.  **Перегляд логів (за потреби)**:
    Якщо контейнери запущені у фоновому режимі, ви можете переглянути їх логи:
    ```bash
    docker-compose logs app
    docker-compose logs db
    ```
    Або для всіх сервісів:
    ```bash
    docker-compose logs -f
    ```

## Зупинка та видалення контейнерів

1.  **Зупинка сервісів**:
    Щоб зупинити запущені контейнери:
    ```bash
    docker-compose stop
    ```

2.  **Зупинка та видалення контейнерів**:
    Щоб зупинити та видалити контейнери, мережі та (за бажанням) томи:
    ```bash
    docker-compose down
    ```
    Якщо ви хочете також видалити томи (включаючи дані бази даних PostgreSQL, що зберігаються в томі `postgres-data`), додайте прапорець `--volumes`:
    ```bash
    docker-compose down --volumes
    ```
    **Увага**: Використання `--volumes` призведе до видалення всіх даних у томах, визначених у `docker-compose.yml`.

## Вирішення проблем

*   **Помилки під час завантаження образу**: Переконайтеся, що змінні `GITHUB_REPOSITORY` та `VERSION` встановлені правильно, і що образ з такою версією існує у вказаному репозиторії контейнерів, або що ви правильно увійшли до `ghcr.io` (`docker login ghcr.io`), якщо образ приватний.
*   **Конфлікти портів**: Якщо порт, який намагається використати Docker Compose, вже зайнятий іншим процесом, ви отримаєте помилку. Змініть мапінг портів у файлі `docker-compose.yml` або зупиніть процес, який використовує цей порт.
*   **Проблеми з базою даних**: Переконайтеся, що сервіс `db` успішно стартував перед сервісом `app`. У `docker-compose.yml` для сервісу `app` може бути налаштована залежність `depends_on: db` та/або `healthcheck` для бази даних, щоб додаток чекав на готовність БД.

# Локальне розгортання за допомогою Docker Compose

Цей документ описує, як розгорнути додаток локально за допомогою Docker Compose.

## Передумови

1.  **Docker**: Переконайтеся, що у вас встановлено Docker. Інструкції зі встановлення можна знайти на [офіційному сайті Docker](https://docs.docker.com/get-docker/).
2.  **Docker Compose**: Docker Compose зазвичай встановлюється разом з Docker Desktop. Якщо ні, інструкції можна знайти [тут](https://docs.docker.com/compose/install/).
3.  **Образ додатку**: Переконайтеся, що образ вашого додатку (`college-schedule-app`) доступний локально або в зазначеному репозиторії контейнерів (наприклад, GHCR). Якщо ви збираєте образ локально, виконайте відповідні кроки для його збірки.

## Кроки для розгортання

1.  **Перейдіть до папки `deploy`**:
    Відкрийте термінал або командний рядок і перейдіть до папки, де знаходиться файл `docker-compose.yml` (ця папка `deploy`).
    ```bash
    cd шлях/до/вашого/проекту/deploy
    ```

2.  **Налаштування змінних середовища (за потреби)**:
    Файл `docker-compose.yml` може використовувати змінні середовища для конфігурації образу додатку. Основними змінними є `GITHUB_REPOSITORY` та `VERSION`.

    *   **`GITHUB_REPOSITORY`**: Це ваш репозиторій на GitHub у форматі `ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ` (наприклад, `chdbc-samples/college-schedule-app`).
    *   **`VERSION`**: Версія образу додатку, яку потрібно розгорнути (наприклад, `0.3.0-SNAPSHOT` або `latest`).

    Ви можете встановити ці змінні у вашому терміналі перед запуском Docker Compose:

    **Для Linux/macOS:**
    ```bash
    export GITHUB_REPOSITORY="ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ"
    export VERSION="версія_образу"
    ```
    Замініть `ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ` та `версія_образу` на ваші актуальні значення.

    **Для Windows (Command Prompt):**
    ```cmd
    set GITHUB_REPOSITORY=ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ
    set VERSION=версія_образу
    ```

    **Для Windows (PowerShell):**
    ```powershell
    $env:GITHUB_REPOSITORY="ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ"
    $env:VERSION="версія_образу"
    ```

    **Альтернатива:** Ви можете створити файл `.env` у папці `deploy` і визначити змінні там:
    ```env
    # filepath: c:\GitHub\college-schedule-app\deploy\.env
    GITHUB_REPOSITORY=ВЛАСНИК/НАЗВА_РЕПОЗИТОРІЮ
    VERSION=версія_образу
    ```
    Docker Compose автоматично підхопить значення з цього файлу.

3.  **Запустіть Docker Compose**:
    Виконайте команду для запуску сервісів у фоновому режимі (`-d`):
    ```bash
    docker-compose up -d
    ```
    Якщо ви хочете бачити логи в терміналі, запустіть без прапорця `-d`:
    ```bash
    docker-compose up
    ```
    Ця команда завантажить необхідні образи (якщо їх немає локально) та запустить контейнери для додатку (`app`) та бази даних (`db`).

4.  **Перевірка стану контейнерів**:
    Щоб перевірити, чи контейнери успішно запустилися, виконайте:
    ```bash
    docker-compose ps
    ```
    Ви повинні побачити контейнери `app` та `db` зі статусом `Up` або `running`.

5.  **Доступ до додатку**:
    Після успішного запуску, ваш додаток повинен бути доступний за адресою, вказаною у конфігурації сервісу `app` (зазвичай `http://localhost:ПОРТ_ДОДАТКУ`). Перевірте файл `docker-compose.yml` на наявність мапінгу портів для сервісу `app`. Наприклад, якщо там вказано `ports: - "8080:8080"`, то додаток буде доступний за адресою `http://localhost:8080`.

    База даних PostgreSQL буде доступна на `localhost:5432` (якщо стандартний порт не змінено).

6.  **Перегляд логів (за потреби)**:
    Якщо контейнери запущені у фоновому режимі, ви можете переглянути їх логи:
    ```bash
    docker-compose logs app
    docker-compose logs db
    ```
    Або для всіх сервісів:
    ```bash
    docker-compose logs -f
    ```

## Зупинка та видалення контейнерів

1.  **Зупинка сервісів**:
    Щоб зупинити запущені контейнери:
    ```bash
    docker-compose stop
    ```

2.  **Зупинка та видалення контейнерів**:
    Щоб зупинити та видалити контейнери, мережі та (за бажанням) томи:
    ```bash
    docker-compose down
    ```
    Якщо ви хочете також видалити томи (включаючи дані бази даних PostgreSQL, що зберігаються в томі `postgres-data`), додайте прапорець `--volumes`:
    ```bash
    docker-compose down --volumes
    ```
    **Увага**: Використання `--volumes` призведе до видалення всіх даних у томах, визначених у `docker-compose.yml`.

## Вирішення проблем

*   **Помилки під час завантаження образу**: Переконайтеся, що змінні `GITHUB_REPOSITORY` та `VERSION` встановлені правильно, і що образ з такою версією існує у вказаному репозиторії контейнерів, або що ви правильно увійшли до `ghcr.io` (`docker login ghcr.io`), якщо образ приватний.
*   **Конфлікти портів**: Якщо порт, який намагається використати Docker Compose, вже зайнятий іншим процесом, ви отримаєте помилку. Змініть мапінг портів у файлі `docker-compose.yml` або зупиніть процес, який використовує цей порт.
*   **Проблеми з базою даних**: Переконайтеся, що сервіс `db` успішно стартував перед сервісом `app`. У `docker-compose.yml` для сервісу `app` може бути налаштована залежність `depends_on: db` та/або `healthcheck` для бази даних, щоб додаток чекав на готовність
